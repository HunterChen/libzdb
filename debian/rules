#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

CFLAGS=-Wall -g
LDFLAGS=

# dpatch
export PACKAGE=libzdb_2.3
export PACKAGES=libzdb_2.3

export MRPROPER=

#ifneq (,$(findstring devel,$(DEB_BUILD_OPTIONS)))
#	export MRPROPER=mrproper
#endif

# shared library versions, option 1
#version=2.0.5
#major=2
# option 2, assuming the library is created as src/.libs/libfoo.so.2.0.5 or so
#version=`ls src/.libs/lib*.so.* | \
# awk '{if (match($$0,/[0-9]+\.[0-9]+\.[0-9]+$$/)) print substr($$0,RSTART)}'`
#major=`ls src/.libs/lib*.so.* | \
# awk '{if (match($$0,/\.so\.[0-9]+$$/)) print substr($$0,RSTART+4)}'`

configure:
	dh_testdir
	./bootstrap
	#autoreconf -f -i

config.status: configure
	dh_testdir
	./configure --prefix=/usr 

build: build-stamp
build-stamp:  config.status
	dh_testdir
	$(MAKE)
	touch $@

clean1:
	dh_testdir
	dh_testroot
	rm -f build-stamp 
	test -e Makefile && $(MAKE) clean || true
	rm -f config.sub config.guess config.status config.log tools/bin/filterh libtool Makefile src/stamp-h1 src/xconfig.h
	dh_clean 

mrproper:
	rm -f Makefile.in test/Makefile test/Makefile.in configure aclocal.m4 src/net/URL.c src/xconfig.h.in
	rm -f config/config.guess config/config.sub test/*.out
	rm -rf tools/bin/ api/

clean: clean1 $(MRPROPER)


install: build
	dh_testdir
	dh_testroot
	dh_clean -k 
	dh_installdirs
	$(MAKE) DESTDIR=$(CURDIR)/debian/tmp install

# Build architecture-independent files here.
binary-indep: build install

# Build architecture-dependent files here.
binary-arch: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs -a CHANGES
	dh_installdocs -a
	dh_install  -a --sourcedir=debian/tmp
	dh_link -a
	dh_strip -a
	dh_compress -a
	dh_fixperms -a
	dh_makeshlibs -a
	dh_installdeb -a
	dh_shlibdeps -a
	dh_gencontrol -a
	dh_md5sums -a
	dh_builddeb -a

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install 
